<!DOCTYPE=html>
<meta charset="utf-8">
<html>
	<div id="navigation"></div>
	<body>
		<div id="searching" class="half right">
			<input type="text" name="search" id="search" onkeyup="search()" placeholder="Search for movies">
				<ul id="movielist">
				</ul>
			<button name="add" id="add" onclick="addToWatchlist()">Add To Watchlist</button>
			<button name="pageP" id="pageP" onclick="prevPage()">Previous</button>
			<button name="pageN" id="pageN" onclick="nextPage()">Next</button>
		</div>
		<div class="half left"><table id="watchlist"></table></div>
	</body>
</html>
<style>
li{
	.height="24px";
	.color="lightslategray";
}
</style>
<script>
	var page=1;
	let movielist=document.querySelector("#movielist");
	let searchbar=document.querySelector("#search");
	let query=searchbar.value;
	const sessionid=("; "+document.cookie).split("; sessionid=").pop().split(";")[0];
	async function search(){
		var fd=new FormData();
		if (searchbar.value!=""){
			if (query==""){
				return false;
			}
			else{
				fd.append("searchquery",query);
			}
		}
		else{
			fd.append("searchquery",searchbar.value);
		}
		if (searchbar.value!=query){
			query=searchbar.value;
			page=1;
		}
		fd.append("type","search");
		fd.append("sessionid",sessionid);
		fd.append("page",page);
		let response=await fetch("movies.php",{
			method:"POST",
			body:fd
		});
		let result=response.json();
		if (result.returnCode!="0"){
			movielist.innerHTML="";
			for (record in data){
				movielist.append(
					'<li id="'+data[record].id+'"><image class="poster" url="'+data[record].poster+'">'+
					data[record].title+data[record].releasedate+data[record].company+
					'<a href="movie?m='+data[record].id+'">See more details</a>'+
					'<input type="checkbox" value='+data[record].id+'>'
					);
			}
		}
		else{
			return false;
		}
		return true;

	}
async function prevPage(){
	if (!searchbar.value!=""){
		return false;
	}
	if (page>1){
		page--;
		return await search();
	}

}
async function nextPage(){
        if (!searchbar.value!=""){
                return false;
        }
        page++;
	if (!await search()){
		page=1;
	}
}
	async function addToWatchList(){
		var fd=new FormData();
		fd.append("type","addToWatchlist");
		fd.append("sessionid",sessionid);
		let checked=document.querySelectorAll('input[type="checkbox"]:"checked"');
		let movies = "{"+checked.join(", ")+"}";
		fd.append("movies",movies);

		let response=await fetch("movies.php",{
                        method:"POST",
                        body:fd
                });
                let result=await response.json();
		console.log(result);
	}

</script>
